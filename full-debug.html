<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>Moltbot Site Full Debug</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .step { background: #f0f0f0; padding: 15px; margin: 15px 0; border-radius: 5px; }
        .success { color: green; font-weight: bold; }
        .error { color: red; font-weight: bold; }
        .info { color: blue; }
        .data { background: white; padding: 10px; margin: 10px 0; border-left: 3px solid #ccc; }
    </style>
</head>
<body>
    <h1>ğŸ” Moltbot Site å®Œæ•´è°ƒè¯•</h1>
    <div id="output"></div>

    <script src="/js/data-loader.js"></script>
    <script>
        const output = document.getElementById('output');
        const dataLoader = new DataLoader();

        function log(message, type = 'info') {
            console.log(message);
            const div = document.createElement('div');
            div.className = `step ${type}`;
            div.innerHTML = message;
            output.appendChild(div);
        }

        async function fullTest() {
            log('<h2>1. æµ‹è¯•æ•°æ®åŠ è½½å™¨</h2>', 'info');

            try {
                const allData = await dataLoader.loadAll();
                log('<span class="success">âœ… loadAll() æˆåŠŸ</span>', 'success');

                log(`<h3>Config:</h3>`, 'info');
                log(`<div class="data">Title: ${allData.config?.site?.title}</div>`, 'info');
                log(`<div class="data">Skills categories: ${allData.config?.skills?.categories?.length}</div>`, 'info');

                log(`<h3>News:</h3>`, 'info');
                log(`<div class="data">Items: ${allData.news?.items?.length}</div>`, 'info');
                log(`<div class="data">Count: ${allData.news?.count}</div>`, 'info');

                if (allData.news?.items?.length > 0) {
                    log(`<div class="data">First item: ${allData.news.items[0].title}</div>`, 'info');
                }

                log(`<h3>Skills:</h3>`, 'info');
                log(`<div class="data">Skills: ${allData.skills?.skills?.length}</div>`, 'info');
                log(`<div class="data">Categories: ${Object.keys(allData.skills?.categories || {}).length}</div>`, 'info');

                log('<h2>2. æ¨¡æ‹Ÿ app.js é€»è¾‘</h2>', 'info');

                // Simulate app.js data setting
                const data = {
                    news: {
                        project_info: allData.config?.site || {},
                        news_items: allData.news?.items || []
                    },
                    skills: {
                        skills: allData.skills?.skills || [],
                        categories: allData.skills?.categories || {}
                    }
                };

                log(`<div class="data">data.news.news_items: ${data.news.news_items?.length}</div>`, 'info');
                log(`<div class="data">data.skills.skills: ${data.skills.skills?.length}</div>`, 'info');

                log('<h2>3. æµ‹è¯•æ¸²æŸ“</h2>', 'info');

                const grid = document.createElement('div');
                grid.id = 'news-grid';
                grid.style.background = '#f9f9f9';
                grid.style.padding = '20px';
                grid.style.marginTop = '20px';
                grid.style.display = 'grid';
                grid.style.gridTemplateColumns = 'repeat(auto-fill, minmax(300px, 1fr))';
                grid.style.gap = '20px';
                document.body.appendChild(grid);

                const items = data.news.news_items || [];
                items.slice(0, 3).forEach((item, i) => {
                    const card = document.createElement('div');
                    card.style.background = 'white';
                    card.style.padding = '15px';
                    card.style.borderRadius = '8px';
                    card.style.boxShadow = '0 2px 4px rgba(0,0,0,0.1)';
                    card.innerHTML = `
                        <h3>${item.title}</h3>
                        <p>${item.summary?.substring(0, 100)}...</p>
                        <small>${item.publish_date}</small>
                    `;
                    grid.appendChild(card);
                });

                log(`<span class="success">âœ… æ¸²æŸ“äº† ${Math.min(3, items.length)} ä¸ªæ–°é—»å¡ç‰‡</span>`, 'success');

            } catch (error) {
                log(`<span class="error">âŒ é”™è¯¯: ${error.message}</span>`, 'error');
                log(`<div class="data">${error.stack}</div>`, 'error');
            }
        }

        // Run test
        fullTest();
    </script>
</body>
</html>
